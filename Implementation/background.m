classdef background < handle
    properties
        scale;       % number of units 
        multiplier;  % the pixel of each unit 
        length;
        grassPath;
        grassImg;
        brickPath;
        brickImg;
        value;       % the final image
        grassMatrix; % boolean matrix recording where are the grass blocks
        brickMatrix; % boolean matrix recording where are the brick blocks
        barriers;
        extraLen;
    end
    
    methods
        function obj = background(Scale, Multiplier) %init
            obj.scale = Scale;
            obj.multiplier = Multiplier;
            obj.length = obj.scale * obj.multiplier;
            obj.extraLen = 4;
            obj.grassPath = 'resources\Grass.png';
            obj.grassImg = imread(obj.grassPath);
            obj.brickPath = 'resources\bricks.png';
            obj.brickImg = imread(obj.brickPath);
            obj.readArray();
            obj.generateImage();
        end
        %=================================================================
        function obj = generateImage(obj)
            img = uint8(zeros(obj.length, obj.length, 3));
            rowStart = 1;
            for (row = 1 : obj.scale)
                rowEnd = rowStart + obj.multiplier - 1;
                colStart = 1;
                for (col = 1 : obj.scale)
                    colEnd = colStart + obj.multiplier - 1;
                    if(obj.grassMatrix(row, col) == 1)
                        img(rowStart : rowEnd, colStart : colEnd, :) = obj.grassImg;
                    end
                    if(obj.brickMatrix(row, col) == 1)
                        img(rowStart : rowEnd, colStart : colEnd, :) = obj.brickImg;
                    end
                    colStart = colEnd + 1;
                end
                rowStart = rowEnd + 1;
            end
            obj.value = img;
            
            % `obj.barriers` defines unpenetrable blocks 
            obj.barriers = obj.grassMatrix + obj.brickMatrix;
        end
        %=================================================================
        function obj = readArray(obj)
            % just initilize the array parameters
            % I don't want to put that on top, so moved into a function

            obj.grassMatrix = flip([...
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1];...
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1];...
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1];...
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1];...
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1];...
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1];...
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1];...
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1];...
                [1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1];...
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1];...
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1];...
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1];...
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1];...
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1];...
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1];...
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1];...
                ]);
            
            % brick will overwrite the grass if overlapped 
            obj.brickMatrix = flip([...
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];...
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];...
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];...
                [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0];...
                [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0];...
                [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0];...
                [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0];...
                [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0];...
                [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0];...
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];...
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];...
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];...
                [0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0];...
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];...
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];...
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];...
                ]);
        end
    end
        
end